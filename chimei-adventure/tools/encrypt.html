<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Encrypt Clues</title>
  <style>
    body{ font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans', Arial, sans-serif; margin: 24px; }
    label{ display:block; font-weight:600; margin-top:12px; }
    input, textarea{ width:100%; padding:8px; font-size:14px; }
    textarea{ height:100px; }
    code{ display:block; white-space:pre-wrap; word-break:break-all; background:#f6f8fa; padding:12px; border-radius:8px; border:1px solid #e1e4e8; }
    .row{ display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 720px){ .row{ grid-template-columns: 1fr 1fr; } }
    button{ margin-top:12px; padding:10px 14px; }
  </style>
  <script>
    function bytesToB64(bytes){
      let bin = '';
      for (let i=0;i<bytes.length;i++){ bin += String.fromCharCode(bytes[i]); }
      return btoa(bin);
    }

    async function encrypt(passphrase, payload){
      const enc = new TextEncoder();
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const baseKey = await crypto.subtle.importKey('raw', enc.encode(passphrase), { name: 'PBKDF2' }, false, ['deriveKey']);
      const aesKey = await crypto.subtle.deriveKey(
        { name: 'PBKDF2', salt, iterations: 120000, hash: 'SHA-256' },
        baseKey,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt']
      );
      const data = enc.encode(JSON.stringify(payload));
      const cipher = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, aesKey, data);
      return {
        salt: bytesToB64(salt),
        iv: bytesToB64(iv),
        cipherText: bytesToB64(new Uint8Array(cipher))
      };
    }

    async function run(idPrefix){
      const key = document.getElementById(idPrefix + '-key').value;
      const word = document.getElementById(idPrefix + '-word').value;
      const note = document.getElementById(idPrefix + '-note').value;
      if(!key || !word){ alert('Key and word are required'); return; }
      const blob = await encrypt(key, { word, note });
      document.getElementById(idPrefix + '-out').textContent = JSON.stringify(blob, null, 2);
    }
  </script>
</head>
<body>
  <h1>Encrypt Clues</h1>
  <p>Use this page locally to produce ciphertext blobs for your two clues. Paste outputs into <code>js/adventure.js</code> replacing the placeholders.</p>

  <div class="row">
    <section>
      <h2>Clue 1</h2>
      <label>Key (user enters in 密碼 I)</label>
      <input id="c1-key" placeholder="e.g., rose">
      <label>Word</label>
      <input id="c1-word" placeholder="e.g., NAVE">
      <label>Note (optional)</label>
      <textarea id="c1-note" placeholder="e.g., 中央長廊光線匯聚處"></textarea>
      <button onclick="run('c1')">Encrypt</button>
      <code id="c1-out"></code>
    </section>

    <section>
      <h2>Clue 2</h2>
      <label>Key (user enters in 密碼 II)</label>
      <input id="c2-key" placeholder="e.g., window">
      <label>Word</label>
      <input id="c2-word" placeholder="e.g., LIGHT">
      <label>Note (optional)</label>
      <textarea id="c2-note" placeholder="e.g., 彩繪玻璃的光斑下"></textarea>
      <button onclick="run('c2')">Encrypt</button>
      <code id="c2-out"></code>
    </section>
  </div>

  <script>
    // map ids used by JS
    document.getElementById('c1-key').id = 'c1-key';
    document.getElementById('c1-word').id = 'c1-word';
    document.getElementById('c1-note').id = 'c1-note';
    document.getElementById('c1-out').id = 'c1-out';

    document.getElementById('c2-key').id = 'c2-key';
    document.getElementById('c2-word').id = 'c2-word';
    document.getElementById('c2-note').id = 'c2-note';
    document.getElementById('c2-out').id = 'c2-out';
  </script>
</body>
</html>

